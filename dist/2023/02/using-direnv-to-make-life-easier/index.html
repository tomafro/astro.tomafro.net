<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width">
    <meta name="description" content="Tom Ward's personal website">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="preload" href="/fonts/rubik.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="/fonts/rubik-italic.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="/fonts/bitter.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="/fonts/bitter-italic.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="/fonts/fira-code.woff2" as="font" type="font/woff2" crossorigin>
    <meta name="generator" content="Astro v2.0.14">
    <title>Using direnv to make life easier - Tom Ward's Blog</title>
  <link rel="stylesheet" href="/_astro/_...slug_.ee8904b2.css" /></head>
  <body class="baseline">
    <div class="content-bounds">
      

<header class="undefined astro-WOK3G3JL">
  <nav class="astro-WOK3G3JL">
    <ul class="sections astro-WOK3G3JL">
      <li class="astro-WOK3G3JL"><a href="/" class="astro-WOK3G3JL">About</a></li>
      <li class="astro-WOK3G3JL"><a href="/weeknotes/1-new-blog-who-dis" class="astro-WOK3G3JL">Weeknotes</a></li>
      <li class="astro-WOK3G3JL"><a href="/projects" class="astro-WOK3G3JL">Projects</a></li>
    </ul>
    <ul class="icons astro-WOK3G3JL">
      <li class="astro-WOK3G3JL">
        <a href="https://hachyderm.io/@tomafro" class="astro-WOK3G3JL">

<svg class="icon astro-PATNJMLL" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Pro 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. -->
  <path d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48 0 0 0-63.72 28.5-63.72 125.7 0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54 0 0 1-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"></path>
</svg></a>
      </li>
      <li class="astro-WOK3G3JL">
        <a href="https://instagram.com/tomafro" class="astro-WOK3G3JL">

<svg class="icon astro-PATNJMLL" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Pro 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. -->
  <path d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"></path>
</svg></a>
      </li>
      <li class="astro-WOK3G3JL">
        <a href="https://github.com/tomafro" class="astro-WOK3G3JL">

<svg class="icon astro-PATNJMLL" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Pro 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. -->
  <path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"></path>
</svg></a>
      </li>
    </ul>
  </nav>
</header>
      <main>
  <article>
    <hgroup>
      <h1>Using direnv to make life easier</h1>
      <h2>
            <time datetime="2023-02-16T00:00:00.000Z">February 16th 2023</time>
          </h2>
    </hgroup>
    <p>One of the tools I find most useful for local development is <a href="https://direnv.net/">direnv</a>. It’s one of a number of similar utilities that hooks into your shell, and alters the environment when you enter or leave a directory.</p>
<p>To give you an example, if you have a folder <code>~/example</code> with the file <code>~/example/.envrc</code></p>
<pre is:raw="" class="astro-code" style="background-color: var(--astro-code-color-background); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: var(--astro-code-token-keyword)">export</span><span style="color: var(--astro-code-color-text)"> EXAMPLE_NAME=</span><span style="color: var(--astro-code-token-string-expression)">"Danie"</span></span></code></pre>
<p>Then when in your shell session you <code>cd</code> into <code>~/example</code> it will export the <code>EXAMPLE_NAME</code> variable:</p>
<pre is:raw="" class="astro-code" style="background-color: var(--astro-code-color-background); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: var(--astro-code-color-text)">❯ </span><span style="color: var(--astro-code-token-function)">cd</span><span style="color: var(--astro-code-color-text)"> </span><span style="color: var(--astro-code-token-keyword)">~</span><span style="color: var(--astro-code-color-text)">/example</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">direnv: loading </span><span style="color: var(--astro-code-token-keyword)">~</span><span style="color: var(--astro-code-color-text)">/example/.envrc</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">direnv: </span><span style="color: var(--astro-code-token-keyword)">export</span><span style="color: var(--astro-code-color-text)"> +EXAMPLE_NAME</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">❯ </span><span style="color: var(--astro-code-token-function)">echo</span><span style="color: var(--astro-code-color-text)"> Hello $EXAMPLE_NAME</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">Hello Danie</span></span></code></pre>
<p>Just as importantly, when you navigate away, the variable will be unset:</p>
<pre is:raw="" class="astro-code" style="background-color: var(--astro-code-color-background); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: var(--astro-code-color-text)">❯ </span><span style="color: var(--astro-code-token-function)">cd</span><span style="color: var(--astro-code-color-text)"> </span><span style="color: var(--astro-code-token-keyword)">~</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">direnv: unloading</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">❯ </span><span style="color: var(--astro-code-token-function)">echo</span><span style="color: var(--astro-code-color-text)"> Hello $EXAMPLE_NAME</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">Hello</span></span></code></pre>
<h2 id="simple-use-cases">Simple use cases</h2>
<p>More command line tools than you might think make use of environment variables, as of course does your shell. There are some obvious and less obvious uses for direnv. Here are a few that I use:</p>
<h3 id="quickly-launch-the-correct-development-database">QUICKLY LAUNCH THE CORRECT DEVELOPMENT DATABASE</h3>
<p>Setting <a href="https://www.postgresql.org/docs/current/libpq-envars.html">Postgres Environment Variables</a> <code>PGDATABASE</code>, <code>PGUSER</code>, and <code>PGPASSWORD</code><sup><a href="#user-content-fn-1" id="user-content-fnref-1" data-footnote-ref="" aria-describedby="footnote-label">1</a></sup> to match my development database credentials means that when in a project folder, <code>psql</code> will open the correct database.</p>
<h3 id="securely-use-aws-secrets-via-1password">SECURELY USE AWS SECRETS (via 1Password)</h3>
<p>Unlike a development database password, I’m more careful with AWS credentials. While <code>AWS_PROFILE</code>, <code>AWS_REGION</code>, and <code>AWS_ACCESS_KEY_ID</code> are safe to share, I prefer to keep <code>AWS_SECRET_ACCESS_KEY</code> values out of my <code>.envrc</code> files. But that doesn’t mean I can’t use them. I store these secrets in 1Password and use the CLI to retrieve them. So my <code>.envrc</code> looks like this:</p>
<pre is:raw="" class="astro-code" style="background-color: var(--astro-code-color-background); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: var(--astro-code-token-keyword)">export</span><span style="color: var(--astro-code-color-text)"> AWS_REGION=eu-west-2</span></span>
<span class="line"><span style="color: var(--astro-code-token-keyword)">export</span><span style="color: var(--astro-code-color-text)"> AWS_ACCESS_KEY_ID=AKABCDEFGHIJKLMNO</span></span>
<span class="line"><span style="color: var(--astro-code-token-keyword)">export</span><span style="color: var(--astro-code-color-text)"> AWS_SECRET_ACCESS_KEY=</span><span style="color: var(--astro-code-token-string-expression)">"$(op </span><span style="color: var(--astro-code-token-function)">read</span><span style="color: var(--astro-code-token-string-expression)"> op://dev/aws/SECRET_ACCESS_KEY)"</span></span></code></pre>
<p>The environment variable is still set to the secret, but the secret itself is stored more securely than in an unencrypted <code>.envrc</code>.</p>
<h3 id="add-arbitrary-commands-to-the-path">Add arbitrary commands to the path</h3>
<p>In one of the clojure projects I work on, the command I use start the REPL is:</p>
<pre is:raw="" class="astro-code" style="background-color: var(--astro-code-color-background); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: var(--astro-code-color-text)">clojure -A:dev:test:backend:backend-test:system-test:repl</span></span></code></pre>
<p>To save having to type this (or more accurately — search the shell history), I put it in a very short script, saved (and <code>.gitignored</code>) in <code>.local/bin/repl</code>. Then in that project’s <code>.envrc</code> I’ve simply put:</p>
<pre is:raw="" class="astro-code" style="background-color: var(--astro-code-color-background); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: var(--astro-code-color-text)">PATH_add ./.local/bin</span></span></code></pre>
<p>When in this project folder, typing <code>repl</code> launches the repl.</p>
<section data-footnotes="" class="footnotes"><p class="sr-only" id="footnote-label">Footnotes</p>
<ol>
<li id="user-content-fn-1">
<p>If I’d set one. YOLO. <a href="#user-content-fnref-1" data-footnote-backref="" class="data-footnote-backref" aria-label="Back to content">↩</a></p>
</li>
</ol>
</section>
  </article>
</main>
      
    </div>
  </body></html>